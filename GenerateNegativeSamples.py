
##################################################################
''''''
''''''
'''
This file is to Generate the negative samples, with the sample size and form 
as the training and testing data
1. The negative samples are generated by the random method.
2. The negatiev samples should not have any element in commone with the training or 
    testing samples.
'''
''''''
''''''

#############################################################################
import os
import json
import random
#import copy
########################################################################### 
'''
Generate_random_negative: 
    a function to generate negative samples with the same pattern and size of the input data.
    By negative samples, we mean the randomly generated samples, and they are not in the data.
Input:
    data: 
        a list of core paires, which is the output of the module of FrameConstraint
    sample_size:
        the size of the negative samples need to be generated
Output:
    negative_samples:
         a list of randomly generated cores, with the element in the form of 
         [['ALA','GLU'], ['TYR','MET'], -1, -1]
         The length of the negative sampels equals to the sample size
         
*****************Important to know***********************
When we generate the negative samples, we have to use the training samples as the reference 
to decide whether the randomly generated samples are negative or not. The testing samples can not
be used because the testing samples are samples that we pretend don't know when we build this model.
'''          
def Generate_random_negative(data, sample_size):
    
    TripleSingle =  [['TYR', 'Y'], ['LYS', 'K'],['ASP', 'D'], ['ASN', 'N'], ['TRP', 'W'], ['PHE', 'F'], ['GLN', 'Q'],
                    ['GLU', 'E'], ['PRO', 'P'], ['GLY', 'G'], ['THR', 'T'],['SER', 'S'], ['ARG', 'R'], ['HIS', 'H'],
                    ['LEU', 'L'], ['ILE', 'I'], ['CYS', 'C'], ['ALA', 'A'], ['MET', 'M'], ['VAL', 'V']]
    AA = []
    for aa in TripleSingle:
        AA.append(aa[0])
     
    Ab_Ag = []
    for parepi in data:
        Ab_Ag.append([parepi[0], parepi[1]])
        
    Ab_length = len(Ab_Ag[0][0])
    Ag_length = len(Ab_Ag[0][1])
    
    negative_samples = []
    while len(negative_samples) < sample_size:
        r_Ab_r_Ag = []
        while r_Ab_r_Ag == []:        
            r_Ab = With_replacement_sample(AA, Ab_length)
            r_Ag = With_replacement_sample(AA, Ag_length)
            r_Ab_r_Ag  = [r_Ab, r_Ag]
            if r_Ab_r_Ag in Ab_Ag:
                r_Ab_r_Ag  = []
        negative_samples.append([r_Ab, r_Ag, 0, 0])
    return negative_samples

def With_replacement_sample(population, size):
    sample = []
    while len(sample) < size:
        sample.extend(random.sample(population,1))
    return sample
###############################################################

def main(positive_core_directory, negative_core_directory):
    # we want to generate 10 set of negative samples
    for n in range(10):    
        negative_directory = negative_core_directory+ '/Sample_'+str(n)
#        os.makedirs(negative_directory)
        for i in range(1, 5):
            for j in range(1,5):                
                for k in [0, 1]:                        
                    for h in [1]:                                                                   

                        train_name ='training_' + str(i)+'_'+str(j)+'_'+str(k)+'_'+str(k)+'_1_2_'+str(h)+'perchain'
                        test_name = 'testing_' + str(i)+'_'+str(j)+'_'+str(k)+'_'+str(k)+'_1_2_'+str(h)+'perchain'
                        print('working on '+ train_name + '\n' + test_name)

                        # Save the core aa
                        os.chdir(positive_core_directory)
                        with open(train_name, 'r') as f:
                            data = json.load(f)
                        with open(test_name, 'r') as f:
                            testing_data = json.load(f)
                        
                        
                        # Generate the negative samples
                        negative_testing_samples = Generate_random_negative(data, len(testing_data))
                        negative_training_samples = Generate_random_negative(data, len(data))
                        
                        # Save the negative samples
                        os.chdir(negative_directory)
                        with open(test_name+'_negative', 'w') as f:
                            json.dump(negative_testing_samples, f)
                        with open(train_name + '_negative', 'w') as f:
                            json.dump(negative_training_samples, f)

   
####################################################################
if __name__ == '__main__':
    positive_core_directory = '/home/leo/Documents/Database/Data_Code_Publish/Cores/Positive_cores'
    negative_core_directory = '/home/leo/Documents/Database/Data_Code_Publish/Cores/Negative_cores'
    main(positive_core_directory, negative_core_directory)

####################################################################


        
        
        
        
        
        
        
        
        
        
        
        
        
